<!DOCTYPE HTML>
<html lang="en"><!-- InstanceBegin template="/Templates/StandardContent.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<!-- InstanceBeginEditable name="doctitle" -->
<title>Drupal Theming</title>
<!-- InstanceEndEditable -->
<link href="../css/oneColFixCtr.css" rel="stylesheet" type="text/css">
<link href="../js/prettify/prettify.css" rel="stylesheet" type="text/css">
<!-- InstanceBeginEditable name="head" -->
<style type="text/css"></style>
<!-- InstanceEndEditable -->
</head>

<body>
<a href="../index.html" style="float:left"><img src="../img/home-button.svg" border="0"></a><!-- InstanceBeginEditable name="content" -->
<h1>Drupal Theming</h1>
<h2>Preparing for Theming Work</h2>
<h3>Overview</h3>
<p>The purpose of theming is to generate the final HTML for display.</p>
<h3>Modules</h3>
<p>There are several modules that make Theme development easier.</p>
<ul>
	<li><strong>Administration Menu</strong><br>
		Creates the drop-down Admin menus.</li>
	<li><strong>Devel</strong><br>
		Not sure yet</li>
	<li><strong>Devel Generate</strong><br>
		Use this to create sample content, users, taxonomy, etc.</li>
	<li><strong>Theme Developer</strong><br>
		Gives you the ability to inspect elements on the screen and see how they were created. You can also dump all SQL statements used to create the page.
<p style="font-weight:bold;">Using the Theme Developer Module</p>
		<p>Of course, when you're first starting out with Drupal, you'll need to get an idea of where the code is located and what you need to override in the first place. The Theme Developer module (<a href="http://drupal.org/project/devel_themer" rel="external">http://drupal.org/project/devel_themer</a>) is the perfect tool to help you figure this out. Once enabled, a checkbox will appear in the bottom right corner of the page. When clicked, a semi-transparent, resizable, and draggable window appears in the top right corner of the page. You can then move it around and click on any element of the page and the window will populate with all the information you need to know—and more</p>
	</li>
	<li><strong>Block Class </strong><br>
		Allows you to add a CSS class name to any block.</li>
</ul>
<h3>Rebuilding Theme Cache</h3>
<p>Shutting off caching does not affect the theme cache, therefore you either need to </p>
<ol>
	<li>clear all caches each time something changes with your theme, or</li>
	<li>check “rebuild the theme registry on every page load” using the Devel module.</li>
</ol>
<h2>Theming Engine</h2>
<p>The default theming engine in Drupal 7 is <em>PHPTemplate</em>.  Before we get to that, let’s back up a second and talk about what theming really is. The point is to allow the designer to layout and structure the HTML in any manner they want. For example, I have a list of primary navigation links: Home, Products, Services, and About Us. Some designers may need those structured as:</p>
<pre class="prettyprint linenums">&lt;nav class=&quot;primary&quot;&gt;
	&lt;ul&gt;
		&lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;Products.php&quot;&gt;Products&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;Services.php&quot;&gt;Services&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;About-Us.php&quot;&gt;About Us&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
&lt;/nav&gt;
</pre>
<p>A different designer/website may need it structured as:</p>
<pre class="prettyprint linenums">&lt;nav class=&quot;primary&quot;&gt;
	&lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;
	&lt;a href=&quot;Products.php&quot;&gt;Products&lt;/a&gt;
	&lt;a href=&quot;Services.php&quot;&gt;Services&lt;/a&gt;
	&lt;a href=&quot;About-Us.php&quot;&gt;About Us&lt;/a&gt;
&lt;/nav&gt;
</pre>
<p>The way Drupal provides this flexibility is by passing <em>content</em> and <em>metadata</em> to the theme engine. In this example, the content is probably an array of Page names and their associated links. The metadata could be styling cues such as &quot;create a verital list of links&quot; vs. horizontal. This combination of content and metadata is called a Render Array in Drupal parlance.</p>
<p>Renderable arrays have two kinds of key/value pairs: properties and children. Properties have keys starting with '#' and their values influence how the array will be rendered. Children are all elements whose keys do not start with a '#'. Their values should be renderable arrays themselves, which will be rendered during the rendering of the parent array. The markup provided by the children is typically inserted into the markup generated by the parent array.</p>
<h2>Methods for Theming</h2>
<p>There are two ways to convert Render Arrays into actual HTML markup—Template Files and Template Functions.</p>
<div class="callout pushRight" style="width:35%;"><h3>Tip: Print out available variables</h3>
	<p>Print the variables array</p>
	<div class="code">&lt;?php<br>
		print '&lt;pre&gt;';<br>
		print_r(get_defined_vars());<br>
		print '&lt;/pre&gt;';<br>
	?&gt;</div>
	<p>Print the variables array with the HTML markup</p>
	<div class="code">&lt;?php<br>
		print '&lt;pre&gt;';<br>
		print htmlspecialchars(print_r(get_defined_vars(), TRUE), ENT_QUOTES);<br>
		print '&lt;/pre&gt;';<br>
	?&gt;</div>
</div><h3>Template Files</h3>
<p>Purposely keeping your Template Files simple will serve you well. Specifically, the tipple files (<code>*.tpl.php</code>) should contain HTML tags and very basic PHP. You PHP should be limited to:</p>
<ul>
	<li>Printing variables that are strings — <code>print $title;</code></li>
	<li>Printing a translatable string — <code>print t(&quot;Hello world&quot;);</code></li>
	<li>If/else statements.</li>
	<li>Removing an element from rendering (this allows you to reorder content if you render it later on in the template)— <code>hide($content['links']);</code></li>
	<li>Rendering page content — <code>render($content);</code></li>
</ul>
<p>You can use some if statements in the tipple file to conditionally display information based on the value of variables. Some  are <strong>global variables</strong> and are available for every single tipple file to use. They are:</p>
<p><code>$is_admin, $logged_in, $is_front, $directory, $user, $language, $theme_hook_suggestions, $title_prefix</code>, and <code>$title_suffix</code>.</p>
<p>Others are defined by various modules.</p>
<p>The naming standard for the tipple files controls which one is used to perform the actual theming. See <a href="#tipple">How to Override Template Files</a> for more information.</p>
<h3>Template Functions</h3>
<p>Like tipple files, the name of the function will control which theming function is used to generate the final HTML. The naming syntax is <code>theme_<em>themeHookName</em>()</code> where <em>themeHookName</em> is defined by <em><code>hook</code></em><code>_theme()</code>. For example,</p>
<pre class="prettyprint linenums">function myModule_theme() {
	return array(
		'sdf' =&gt; '</pre>
<p>&nbsp;	</p>
<p>Many standard theme functions can be found in <code>/includes/theme.inc</code></p>
<p>You can find a <a href="https://api.drupal.org/api/group/themeable/7" rel="external">list of themeable functions</a> on the Drupal.org site.</p>
<h4>theme(<em>themeFunction</em>, <em>variables</em>)</h4>
<p>The <code>theme()</code> function will kick-off the specified theming function to generate the final HTML based on the variables passed into theme(). That said, it is recommended that you call <code>drupal_render()</code> instead of <code>theme()</code>.</p>

<h2 id="tipple">*.tpl.php Files — How to Override Template Files</h2>
<p>The template file that Drupal chooses to use is based on what is getting themed. It will use the most specific <a href="#templateSuggestions">Template Suggestion</a> it can find. When looking at the “Theming Blocks” and “Theming Nodes” sections below you will notice that each of those modules (yeah, that core functionality of Drupal is just a module, not unlike a custom module you might build) includes a default implementation of a template file (<code>block.tpl.php</code> and <code>node.tpl.php</code>). Those template files are used to style that type of content, unless a theme developer overrides it with their own version of a *.tpl.php file.</p>
<h3>Theming Blocks</h3>
<p>For example, let’s say Drupal is attempting to theme a <strong>block</strong>. It will look in this order:</p>
<ol>
	<li><code>block--<em>module</em>--<em>delta</em>.tpl.php</code> (a delta is just a specific block created via the UI or by a module).</li>
	<li><code>block--<em>module</em>.tpl.php</code> (block--block.tpl.php applies to blocks created in the UI.)</li>
	<li><code>block--<em>region</em><em></em>.tpl.php</code></li>
	<li><code>block.tpl.php</code> (if this is in your theme directory it’ll be used, otherwise it’ll use the default found at /modules/block/block.tpl.php)</li>
</ol>
<p>This process is great for tweaking your <em>theme</em>, but what about tweaking the display for a block created by a <em>custom module</em>? It may be possible using <code><em>hook</em>_theme_registry_alter()</code>, but honestly, it just may not be worth <a href="https://www.drupal.org/node/715160" rel="external">going through the trouble</a>. Just shove your styling into the current theme instead.</p>
<p>Also one more example with Views, if you have a block created by views with a view name "front_news" and display id "block_1" then the theme hook suggestion would be: <code>block--views--front-news-block-1.tpl.php</code> (notice, when you have underscores in a display id or in a view name - you have to transform them in to a single dash.)</p>
<h3>Theming Nodes</h3>
<p>Theming nodes uses the same process as Blocks, except the names are:</p>
<ol>
	<li><code>node--<em>nodeID</em>.tpl.php</code></li>
	<li><code>node--<em>nodeType</em>.tpl.php</code></li>
	<li><code>node.tpl.php</code> (if this is in your theme directory it’ll be used, otherwise it’ll use the default found at /modules/node/node.tpl.php)</li>
</ol>
<h3>Theming Overall Structure of a Page</h3>
<p>There are two template files that control the overall structure of a page (kinda like Dreamweaver templates) — <code>html.tpl.php</code> and <code>page.tpl.php.</code> It is pretty rare (I think) to modify the default <code>html.tpl.php</code> file. <code>page.tpl.php</code>, on the other hand, is used to control the visible structure of your page and will definitely need to be created for a custom theme.</p>
<p>For a list of overrides and when they are used, check out page 307 of DGD7. To whet your appetite:</p>
<ul>
	<li><code>page--<em>directory</em>--<em>subDirectory</em>.tpl.php</code></li>
	<li><code>page--<em>directory</em>--<em>%</em>.tpl.php</code></li>
	<li><code>page--<em>directory</em>.tpl.php</code> (ex: page--node.tpl.php for any node)</li>
	<li><code>page--front.tpl.php</code></li>
	<li><code>page.tpl.php</code></li>
</ul>
<h3 id="templateSuggestions">Template Suggestions</h3>
<p>Drupal sets some default Template Suggestions for you automatically, but as a module developer, we are free to add to the list of suggestions. The Template Suggestions are defined in <code>template_preprocess_<em>hook</em></code>, so for Blocks, you can find it in <code>template_preprocess_block()</code>.</p>
<h2>General Appearance and Settings</h2>
<h3 id="905-3">Global Theme Settings</h3>
<p id="906-1">Drupal comes with some theme settings that can be configured in the administrative interface. This is where most of the site identity assets are defined, as well as a couple of other miscellaneous settings. A Global Settings page located at admin/appearance/settingscontains these settings. When global settings are saved, the settings apply to all themes. Each theme also has its own Settings page accessible via a Settings link located next to each enabled theme on the admin/appearance page. When theme settings are applied on an individual theme's Settings page, they override the global settings. The following sections will detail what each of these are and where you'll encounter them in your themes.</p>
<p id="906-2">Quite a few of these settings determine whether or not variables are populated and therefore printed in template files. The settings pictured in<a onclick="internalJump('ch15fig06'); return true;">Figure 15-6</a> represent the defaults provided by Drupal. These can be overridden by themes by defining features in the theme's .info file, which is discussed further in the "Defining Theme Metadata" section. When specifying features in .info files, you'll need to make sure you include all the features you want to support, as having just one will override all of the defaults provided by Drupal. The following is a quick reference of these settings as they'd be entered in a .info file:</p>
<hr>
<div id="N109">
	<pre id="906-3">features[] = logo
features[] = name 
features[] = slogan 
features[] = favicon 
features[] = main_menu 
features[] = secondary_menu 
features[] = node_user_picture 
features[] = comment_user_picture 
features[] = comment_user_verification</pre>
</div>
<hr>
<div id="ch15fig06"><a href="javascript:PopImage('IMG_148','http://images.books24x7.com/bookimages/id_43343/fig337_01_0.jpg','748','607')" name="IMG_148" target="_self"><img alt="Image from book" border="0" height="284" id="IMG_148" src="http://images.books24x7.com/bookimages/id_43343/fig337_01.jpg" title="Click To expand" width="350"></a> <br>
	<span id="908-1">Figure 15-6: The Global Settings page</span></div>
<div id="ch15lev3sec5">
	<h4 id="annotationlabel-1">Logo</h4>
	<p id="909-1">By default, Drupal will look for a file named logo.png in the root of the theme directory. There is also an option to specify a path to a different file to use for the logo, as well as the ability to upload a logo to use. When the Logo checkbox is checked, a variable called $logois populated with the path to the logo, which will be available in page.tpl.php. If unchecked, the logo will not print.</p>
</div>
<div id="ch15lev3sec6">
	<h4 id="annotationlabel-2">Name and Slogan</h4>
	<p id="910-1">The site name is defined during the installation process. Both the site name and slogan can be changed on theadmin/config/system/site-information page. On the theme's Settings page, you can toggle their visibility. Both are available inpage.tpl.php as $site_name and $site_slogan.</p>
</div>
<div id="ch15lev3sec7">
	<h4 id="annotationlabel-3">Shortcut Icon</h4>
	<p id="912-1">The shortcut icon, also known as the favicon, is the small Drupal icon that appears in the address bar, bookmarks, and tabs of most browsers. Like the logo, the shortcut icon's visibility can be toggled and a custom file can be used. The default file is misc/favicon.ico.</p>
</div>
<div id="ch15lev3sec8">
	<h4 id="annotationlabel-4">User Pictures in Posts and Comments</h4>
	<p id="913-1">These settings control whether or not the variables $user_picture in node.tpl.php and $picture in comment.tpl.php are populated, and therefore whether or not the pictures are displayed when viewing nodes and comments.</p>
</div>
<div id="ch15lev3sec9">
	<h4 id="annotationlabel-5">User Verification Status in Comments</h4>
	<p id="914-1">This option will display "(Not verified)" next to the user name for users that do not have a verified account. This text is defined intemplate_preprocess_username() and printed in theme_username() as $variables['extra']. See the "<a href="http://library.books24x7.com/assetviewer.aspx?bkid=43343&destid=1022#1022" target="_parent">Preprocess and Process Functions</a>" and "<a href="http://library.books24x7.com/assetviewer.aspx?bkid=43343&destid=982#982" target="_parent">Theme Functions</a>" sections to learn how to change this.</p>
</div>
<div id="ch15lev3sec10">
	<h4 id="annotationlabel-6">Main and Secondary Menus</h4>
	<p id="915-1">When the checkboxes for the Main and Secondary menus are checked, $main_menu and $secondary_menu variables are populated for use by page.tpl.php with arrays containing the menu links for each menu. On the Menu Settings page, located at admin/structure/menu/settings, you can choose which menu is used for each. By default, the Main menu, which can be managed at admin/structure/menu/manage/main-menu, is used as the source that populates $main_menu. The default menu for the source of the Secondary menu is the User menu, which can be managed at admin/structure/menu/manage/user-menu.</p>
	<p id="915-2">These are simple, one-level menus, generated by the <code>theme_links()</code> function  in page.tpl.php. This makes them hard to use when styling complex navigation designs. Because complex navigation is often required, many theme developers create regions for navigation and use blocks to output their menus instead of using these menus. We highly recommend the Menu Block module (<a href="http://drupal.org/project/menu_block" target="_top">http://drupal.org/project/menu_block</a>), which allows you to do pretty much anything you'll ever need to do with menus very easily.</p>
</div>
<p>&nbsp;</p>
<h2>Pre-Process and Process Functions</h2>
<p>Before a page is sent to the theming engine, most of the variable content is locked up in Render Arrays. Through the use of Alter and Preprocess functions, you can modify those arrays, or add and delete content. When writing a preprocess function it uses the naming scheme:</p>
<p><code>function <em>module</em>_preprocess_<em>themeHookName</em>(&amp;$variables) { ...</code></p>
<p>where <em>module</em> is the internal name of your module and <em>themeHookName</em> is <span style="font-size:smaller;">(the Hook Suggestion name???)</span>.</p>
<p>&nbsp;</p>
<h2>CSS</h2>
<p>One way to add external stylesheets is through a preprocess function on <em><code>theme</code></em><code>_preprocess_html()</code>. Example:</p>
<pre class="prettyprint linenums">// ADD REFERENCE TO EXTERNAL STYLESHEET
	function bartiksub_preprocess_html(&amp;$variables) {
	drupal_add_css('http://fonts.googleapis.com/css?family=News+Cycle', array('type' =&gt; 'external'));
}</pre>
<h2>Javascript</h2>
<p>Like adding external CSS, the only way to get an external Javascript file into Drupal is via the preprocess_html hook.</p>
<pre class="prettyprint linenums">// ADD REFERENCE TO EXTERNAL SCRIPT
	function bartiksub_preprocess_html(&amp;$variables) {
	drupal_add_js('http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js', 'external');
}</pre>
<h3 id="sec_attached">Attaching libraries in render arrays</h3>
<p>The #attached property allows loading of CSS, JavaScript, libraries or custom types. Specify an array of type =&gt; value pairs, where the type (most often 'css', 'js', or 'library') determines the loading technique and the value provides the options specified to the loader function. Example:</p>
<pre class="prettyprint linenums">$form['#attached']['css'] = array(<a href="https://api.drupal.org/api/drupal/core%21includes%21common.inc/function/drupal_get_path/8" title="Returns the path to a system item (module, theme, etc.).">drupal_get_path</a>('module', 'ajax_example') . '/ajax_example.css', );
$form['#attached']['js'] = array(  <a href="https://api.drupal.org/api/drupal/core%21includes%21common.inc/function/drupal_get_path/8" title="Returns the path to a system item (module, theme, etc.).">drupal_get_path</a>('module', 'ajax_example') . '/ajax_example.js', );</pre>
<h2>Regions</h2>
<p>Regions are generated via     <span class="code">&lt;?php print render($page['custom']); ?&gt;</span></p>
<h3 id="933-2">Default Regions</h3>
<p id="934-1">Drupal core defines nine regions for themes to utilize programmatically by default. The code in <a onclick="internalJump('ch15ex02'); return true;">Listing 15-2</a> duplicates the default core regions in .info file format. Like most theme layer implementations, the reason themes define regions is because they want to modify or add to the defaults. Until a theme defines its own regions, Drupal will use the defaults. This means that if the default regions are sufficient for your design, you will not need to define regions in your theme's .info file.</p>
<div id="ch15ex02"><span id="934-2">Listing 15-2: Drupal's Nine Predefined Theme Regions in Chronological Order</span><a name="935" id="935"></a><a name="ch15ex02" id="ch15ex02"></a>
	<div id="ch15ex02">
		<hr>
		<pre id="935-1"> regions[page_top] = Page Top 
regions[header] = Header 
regions[highlighted] = Highlighted 
regions[help] = Help 
regions[content] = Content 
regions[sidebar_first] = Sidebar First 
regions[sidebar_second] = Sidebar Second 
regions[footer] = Footer 
regions[page_bottom] = Page Bottom </pre>
		<hr>
		<div></div>
	</div>
</div>
<p id="935-2">However, including this code in your theme’s .info file to begin with is a good practice. Once you define a single region in your theme, it will override core defaults, so having the full list of defaults and commenting out regions that you have disabled (instead of deleting or omitting them entirely) is a good way to keep track of what you're doing with them. You will need some of these regions, namely thepage_top, content, and page_bottom regions. These are required and must be printed in every Drupal theme to maintain a properly functioning site. An example of how one might organize regions in an .info file, taking defaults into account, is shown in <a onclick="internalJump('ch15ex03'); return true;">Listing 15-3</a>.</p>
<div id="ch15ex03"><span id="935-3">Listing 15-3: An Example of Region Implementation in a Theme's .info File</span><a id="936" name="936"></a><a id="ch15ex03" name="ch15ex03"></a>
	<div id="ch15ex03">
		<hr>
		<pre id="936-1">; CORE REGIONS - DISABLED 
;regions[highlighted] = Highlighted 
;regions[help] = Help 
;regions[header] = Header 
;regions[footer] = Footer 
 
; CORE REGIONS - REQUIRED 
regions[page_top] = Page Top 
regions[content] = Content 
regions[page_bottom] = Page Bottom  

; CORE REGIONS 
regions[sidebar_first] = Sidebar First 
regions[sidebar_second] = Sidebar Second  

; CUSTOM REGIONS 
regions[my_custom_region] = My Custom Region</pre>
	</div>
</div>
<p>&nbsp;</p>
<h2>Showing Images</h2>
<h3>PHP Functions</h3>
<p><code>url()</code> Makes a safe URL</p>
<p> <code>base_path()</code> Returns the base location of the Drupal install. It will always include the trailing slash. In most cases, this function will always return just a &ldquo;/&rdquo; because most installs have Drupal installed to a top level directory of the webroot. <em>Note: Do not combine with </em><em>path_to_theme() because that function apparently already takes into account the base.</em></p>
<p> <code>path_to_theme()</code> Returns the directory of the current theme. Example:</p>
<p><code> &lt;img src=&quot;&lt;?php echo url(path_to_theme(); ?&gt;&quot;/img/myPic.jpg&rsquo;); alt=&quot;&quot;&gt;</code></p>
<p>&nbsp;</p>
<!-- InstanceEndEditable -->
<footer>
		<hr>
		<p style="font-size:1rem !important; text-align:left;margin-bottom:1em; float:left;"><a href="https://craig-creeger.github.io/">Table of Contents</a>
		</p>
		<p style="text-align:right; font-size:smaller;">Last updated on 
			<!-- #BeginDate format:Am1 -->October 28, 2015<!-- #EndDate --></p>
		<p class="tagLine" style="clear:left;">Making Every Pixel Count</p>
		<p><span id="copyrightDate">2015</span> &mdash; All rights reserved. <a href="http://pixelpro.biz/" title="Pixel Pro Web Design">Pixel Pro, Inc.</a></p>
</footer>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/prettify/prettify.js"></script>
<!-- InstanceBeginEditable name="footerScripts" --> <!-- InstanceEndEditable -->
<script type="text/javascript">
$(function() { //shortcut for $(document).ready();
	prettyPrint();
	
	//Update the Copyright Date in the footer to be the current year.
	var crDate = document.getElementById('copyrightDate');
	var today = new Date();
	crDate.innerHTML = today.getFullYear();
});
</script>
</body>
<!-- InstanceEnd --></html>
